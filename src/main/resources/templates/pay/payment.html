<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>짐캐리 | 결제페이지</title>
    <link rel="stylesheet" href="/css/main/header.css">
    <link rel="stylesheet" href="/css/pay/payment.css">
    <link rel="stylesheet" href="/css/main/footer.css">
    <link rel="stylesheet" href="/css/pay/pay-model.css">
    <link rel="icon" href="/image/favicon.png">

</head>
<body>
    <div>
        <header th:insert="~{main/header.html :: mainHeader}"></header>

            <div class="container-pay">
                <h2 class="big">예약정보</h2>
                <div class="wrapper">
                    <div class="wrap-pay">
                        <h3 class="medium">예약 창고</h3>

                        </div>

                        <div class="sharebox-payment-container">
                            <span class="sharbox-photo"></span>
                            <span class="sharebox-size-wrap">
                                <span class="sharebox-size" th:text="${storageTitle}">[이비에] KF94 새부리형 마스크 베이지 대형 10매</span>
                            </span>
                            <span class="sharebox-count-month" th:text="${paymentMonth} + '개월'">1개월</span>
                            <span class="sharbox-price-wrap">
                                <span class="sharebox-price" th:text="${paymentAmount} + '원'">9,800원</span>
                            </span>
                        </div>


                        <div class="my-info">
                            <h3 class="my-title">예약자 정보</h3>
                        </div>

                        <div id="carry-order-info" class="order-info">
                             <div class="order-box">
                                <div class="order-info-box" th:object="${user}">
                                    <div class="order-wrap">
                                        <span class="order-name">예약자</span>
                                        <div class="name-wrap">
                                            <div class="name" th:text="*{userName}"></div>
                                        </div>
                                    </div>

                                    <div class="order-wrap">
                                        <span class="info-title">휴대폰</span>
                                        <div class="name-wrap">
                                            <div class="phone-num" th:text="*{userPhone}"></div>
                                        </div>
                                    </div>
                                    <div class="order-wrap">
                                        <span class="info-title">이메일</span>
                                        <div class="name-wrap" th:text="*{userEmail}">

                                            <div class="email-wrap">
                                                <p class="email-content">
                                                    정보 변경은 마이페이지  개인정보 수정 메뉴에서 가능합니다.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 결제수단 -->

                                    <!-- <div class="payment-select-wrap-container"> -->
                                      <!--   <div class="payment-select-wrapper"> -->
<!--                                            <div class="payment-title-wrap">-->
<!--                                                <h3 class="my-title">결제 수단</h3>-->
<!--                                            </div>-->


<!--                            &lt;!&ndash; 결제 선택 &ndash;&gt;-->
<!--                            <div class="payment-select-wrap">-->
<!--                                <span class="payment-select-title">결제수단 선택</span>-->
<!--                                <div class="pay-select-container">-->
<!--                                    <div class="pay-select-wrap">-->
<!--                                        <div class="pay-select">-->
<!--                                            <button type="button" class="kakao-pay-btn" data-testid="kakao-pay-button" color="#f6e500" id="payBtn">-->
<!--                                                <img class="css-1wbfblw e1ewacwr0" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgICA8ZyBmaWxsPSIjMDAwIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxwYXRoIGQ9Ik03LjUxNSAyLjhDMy4zNjUgMi44IDAgNS40NDUgMCA4LjcwN2MwIDEuOTM4IDEuMTg3IDMuNjU3IDMuMDIxIDQuNzM0LS4xOTEuNzY4LS42ODQgMi43NDItLjc1IDIuOTU3LS4wODMuMjY2LS4xMDMgMS4wNDYuNzAyLjUxMi42MzQtLjQyIDIuNDc5LTEuNyAzLjU3LTIuMzQ4LjMxOC4wMzMuNjQyLjA1MS45NzIuMDUxIDQuMTUgMCA3LjUxNS0yLjY0NCA3LjUxNS01LjkwNiAwLTMuMjYyLTMuMzY1LTUuOTA3LTcuNTE1LTUuOTA3TTIxLjA0OCA0LjExM2MxLjUxNy0xLjMxMyAzLjQ2OC0xLjUwOCA0Ljg5My0uNTg1IDEuNzA3IDEuMTA2IDIuMTY4IDIuNzU0IDIuMTY4IDQuODkyIDAgMi40LTEuMTE1IDMuOTY4LTEuNjQyIDQuNDYtLjUyNi40OTMtMS42NzMgMS4yOTItMi44OCAxLjI5MkgyMS40MnYzLjc4NGgtMi45MTFWMy4yODJoMi4xMDZzLjI2LjU0OC40MzMuODN6bTEuOTUxIDEuMTUzYy0uNjk3IDAtMS4xNTMuMTc3LTEuNTMzLjQ3N3Y2LjMwNmgxLjEzOGMuNTU4IDAgMi41NDctLjUwNyAyL-->
<!--                                                jU0Ny0zLjM4MyAwLS42NzctLjA5LTEuMzg1LS4yNzgtMS45LS4zNTctLjk3Ny0xLjI0Ny0xLjUtMS44NzQtMS41ek0zMy44MTcgMy4wNDZjMi4wODUgMCAyLjk0Mi43MTggMy40NDggMS4zNTQuNDgxLjYwNC44NjIgMS40OTcuODYyIDIuOHY2LjY4aC0yLjI2di0uOTU0cy0uNDQyLjQyLTEuMzc5LjgzMWMtLjk4LjQzLTIuNjUzLjg3Ny00LjA0MS0uMTg0LTEuMzk3LTEuMDY4LTEuMi0zLjQ3MS0uODUyLTQuMTU0LjQ4LS45MzggMS4zNjMtMS45NjggMy43MTYtMS45NjhoMi4wMjl2LS45MDhjMC0uNTU0LS41ODMtMS4xMDctMS43My0xLjEwNy0xLjI4IDAtMS44MzMuMTkyLTIuODE3LjYzNWwtLjk5Ni0xLjk0M3MxLjQ5Ni0xLjA4MiA0LjAyLTEuMDgyem0xLjQ3NyA2LjI1aC0xLjQxNWMtLjU5OSAwLTEuOTYxLjIxNi0xLjk2MSAxLjQ3NyAwIDEuMjgzIDEuMDkgMS4yNiAxLjQ0OCAxLjIzIDEuMDg5LS4wOTEgMS45MzgtLjc5NCAxLjkzOC0uNzk0bC0uMDEtMS45MTN6TTQ3LjA2MSAzLjA0NmwtMi4yOTEgOC4xMTEtMi41NC04LjExLTIuODQ5LjgyczMuNSA5LjM4MyAzLjYyNCA5Ljc4M2MuMTIzLjQtLjAwNS44NTgtLjI4IDEuMzIyLS4zNzEuNjMtMS44MjYgMi4wMy0xLjgyNiAyLjAzbDEuODc4IDEuNjYzcy44NTctLjY4OCAxLjc0NS0xLjc1NWMuNzQzLS44OTIgMS42MzYtMi44MyAxLjkzOC0zLjU3Ny44NTktMi4xMTkgMy40Mi05LjQ2NiAzLjQyLTkuNDY2bC0yLjgxOS0uODJ6Ii8+CiAgICA8L2c+Cjwvc3ZnPgo=" alt="카카오페이"></button>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </div>-->
<!--                            </div>-->



<!--                                <ul class="pay-ul">-->
<!--                                    <li>※ 카카오페이 결제 시, 결제하신 수단으로만 환불되는 점 양해부탁드립니다.</li>-->
<!--                                    <li>※ 고객님은 안전거래를 위해 현금 등으로 결제시 저희 쇼핑몰에서 가입한 토스 페이먼츠의 구매안전(에스크로) 서비스를 이용하실 수 있습니다.</li>-->
<!--                                </ul>-->

                                <div class="priv-info">
                                    <h3 class="priv-info-title">개인정보 수집/제공</h3>
                                </div>

                            <div class="priv-info-wrap">
                                <div class="priv-info-cont">
                                    <span class="priv-title">개인정보 수집∙이용 및 처리 동의</span>
                                    <!--  <button class="prom">보기</button> -->
                                </div>


                                <div class="priv-info-cont">
                                    <span class="priv-title">전자지급 결제대행 서비스 이용약관 동의</span>
                                    <!-- <button class="prom">
                                        보기
                                    </button> -->
                                </div>
                                <strong class="priv-agree">
                                    위 내용을 확인 하였으며 결제에 동의합니다.
                                </strong>
                            </div>

                                <p class="agree-read">예약완료 상태일 경우에만 예약 취소가 가능하며, 예약 하루 전까지  결제하신 수단으로 환불됩니다.</p>
                                <p class="agree-read">JimCarry 내 개별 판매자가 등록한 오픈창고 상품의 경우 JimCarry는 통신판매중개자로서 주문, 품질, 교환/환불 등 의무와 책임을 부담하지 않습니다.</p>
                            </div>


                            <!-- 결제금액 영수증같은애 -->
                            <div class="payment-price-container">
                                <div class="payment-price-wrap">

                                        <div class="payment-price-title-wrap">
                                            <h3 class="payment-price-title">결제 금액</h3>
                                        </div>

                                    <div class="payment-sharebox-use-date-container">
                                        <div class="payment-sharebox-use-date-wrap">
                                            <div class="payment-sharebox-use-date-title">개월수</div>
                                            <div>
                                                <span class="payment-sharebox-date-wrap" th:text="${paymentMonth}">
                                                    3개월
                                                </span>
                                            </div>
                                        </div>

                                        <div class="payment-sharebox-price-container">
                                            <div class="payment-sharebox-price-title">창고이용금액</div>
                                            <div>
                                                <span class="payment-sharebox-price" th:text="${paymentAmount}">
                                                    10,900
                                                </span>
                                                <span class="payment-sharebox-date">원</span>
                                            </div>
                                        </div>

                                                    <div class="payment-container">
                                                        <div class="payment-title-d">최종결제금액</div>
                                                        <div>
                                                            <span class="payment" th:text="${paymentAmount}">
                                                                13,500
                                                            </span>
                                                            <span class="payment-sharebox-date">원</span>
                                                        </div>
                                                    </div>
                                    </div>
                                <!-- </div> -->
                        </div>
                    </div>
                </div>
            </div>


                <!-- 결제 버튼 -->
                <!-- 결제버튼 누르면 카카오 결제 api창으로 이동하기 -->
                <div class="last-payment-wrap">
                    <button id="payBtns" class="last-payment-btn" type="button" width="240" height="56" radius="3" style="margin-top: 85px;">
                        <span class="last-payment-name">결제하기</span>
                    </button>
                </div>
            </div>

        <!-- 결제 취소 모달 -->
        <div id="modal" class="modal" style="display: none; z-index: 1000;">
            <div class="modal-content" >
                <div class="pay-content">결제를 취소했습니다.</div>
                <div class="pay-footer">
                    <button class="pay-popup-check">확인</button>
                </div>
            </div>
        </div>

    <footer th:insert="~{main/footer.html :: mainFooter}"></footer>

</body>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.bootpay.co.kr/js/bootpay-3.3.1.min.js" type="application/javascript"></script>
<script src="https://js.bootpay.co.kr/bootpay-4.2.8.min.js" type="application/javascript"></script>
<script th:inline="javascript">
    let storageTitle = [[${storageTitle}]];
    let paymentMonth = [[${paymentMonth}]];
    let paymentAmount = [[${paymentAmount}]];
    let storageId = [[${storageId}]];
    /*부트페이 결제 API*/
    $('#payBtn, #payBtns').on('click', function() {
        BootPay.request({
            price: paymentAmount, //실제 결제되는 가격

            // 관리자로그인 -> 결제설치 -> 인증키 및 보안 -> WEB Application ID
            application_id: "6420f19a755e27001e7e35bc",

            name: '짐캐리', //결제창에서 보여질 이름
            pg: '',
            method: 'card', //결제수단, 입력하지 않으면 결제수단 선택부터 화면이 시작합니다.
            show_agree_window: 0, // 부트페이 정보 동의 창 보이기 여부
            items: [
                {
                    item_name: storageTitle, //상품명
                    qty: paymentMonth, //수량
                    unique: '123', //해당 상품을 구분짓는 primary key
                    price: paymentAmount, //상품 단가
                }
            ],
            order_id: '고유order_id_1234', //고유 주문번호로, 생성하신 값을 보내주셔야 합니다.
        }).error(function (data) {
            //결제 진행시 에러가 발생하면 수행됩니다.
            console.log(data);
        }).cancel(function (data) {
            //결제가 취소되면 수행됩니다.
            const container = document.querySelector(".modal");
            const close = document.querySelector(".pay-popup-check");

            //모달창 열기
            container.style.display = "block";

            //모달창 닫기
            close.addEventListener("click", function () {
                container.style.display = "none";
            });
            console.log(data);

        }).close(function (data) {
            // 결제창이 닫힐때 수행됩니다. (성공,실패,취소에 상관없이 모두 수행됨)
            console.log(data);
        }).done(function (data) {
            //결제가 정상적으로 완료되면 수행됩니다
            //비즈니스 로직을 수행하기 전에 결제 유효성 검증을 하시길 추천합니다.4
            $.ajax({
                url: "/pay/payRegister", // 컨트롤러 주소
                type: "POST",
                data: { paymentAmount : paymentAmount, storageId : storageId }, // 결제정보 객체 paymetnVO
                success: function (result) {
                    location.href = result;
                },
                error: function (error) {
                    console.log(error);
                }
            });
            console.log(data);
        });
    });
</script>
<script src="/js/main/header.js"></script>
</html>